<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admissão Obstétrica Digital</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .animate-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .loading-shimmer { background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
    </style>
</head>
<body class="bg-slate-100 min-h-screen p-2 md:p-6 text-slate-900">

    <div class="max-w-6xl mx-auto space-y-4">
        <!-- Header -->
        <header class="bg-blue-900 text-white p-6 rounded-t-2xl shadow-lg flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-bold flex items-center gap-2">
                    <i data-lucide="stethoscope"></i> Admissão Obstétrica Digital ✨
                </h1>
                <p class="text-blue-200 text-sm italic text-wrap">Suporte à Decisão com IA - Dr. Plantonista</p>
            </div>
            <div class="hidden md:block text-right">
                <p class="text-[10px] opacity-70 uppercase tracking-widest">Protocolo Maternidade</p>
                <p id="current-date" class="font-mono text-xs"></p>
            </div>
        </header>

        <!-- Tabs -->
        <nav class="flex bg-white border-x border-slate-200 shadow-sm">
            <button onclick="switchTab('clinica')" id="tab-clinica" class="flex-1 py-4 text-sm font-bold uppercase tracking-wider flex items-center justify-center gap-2 transition-all border-b-4 border-blue-600 bg-blue-50 text-blue-800">
                <i data-lucide="alert-circle" class="w-4 h-4"></i> Clínica & Anamnese
            </button>
            <button onclick="switchTab('documentos')" id="tab-documentos" class="flex-1 py-4 text-sm font-bold uppercase tracking-wider flex items-center justify-center gap-2 transition-all text-slate-400 border-b-4 border-transparent hover:text-slate-600">
                <i data-lucide="beaker" class="w-4 h-4"></i> Apoio & Documentos ✨
            </button>
        </nav>

        <main class="bg-white shadow-xl rounded-b-2xl p-4 md:p-8 space-y-10 border-x border-b border-slate-200">
            
            <!-- ABA CLÍNICA -->
            <div id="content-clinica" class="space-y-10 animate-in">
                <section>
                    <div class="flex items-center gap-2 mb-4 border-b pb-2 text-blue-900">
                        <span class="bg-blue-600 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold">1</span>
                        <h2 class="text-lg font-bold uppercase">Identificação</h2>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div class="md:col-span-2">
                            <label class="text-[10px] font-bold text-slate-500 uppercase">Nome Completo</label>
                            <input type="text" id="nome" class="w-full p-2 border rounded-md bg-slate-50 uppercase" placeholder="NOME DA PACIENTE">
                        </div>
                        <div>
                            <label class="text-[10px] font-bold text-slate-500 uppercase">Idade</label>
                            <input type="text" id="idade" class="w-full p-2 border rounded-md bg-slate-50">
                        </div>
                        <div>
                            <label class="text-[10px] font-bold text-slate-500 uppercase">Prontuário</label>
                            <input type="text" id="prontuario" class="w-full p-2 border rounded-md bg-slate-50">
                        </div>
                        <div class="grid grid-cols-4 gap-2">
                            <div><label class="text-[10px] font-bold block">G</label><input id="ge" class="w-full p-1 border rounded text-center"></div>
                            <div><label class="text-[10px] font-bold block">PN</label><input id="pa_n" class="w-full p-1 border rounded text-center"></div>
                            <div><label class="text-[10px] font-bold block">PC</label><input id="pa_c" class="w-full p-1 border rounded text-center"></div>
                            <div><label class="text-[10px] font-bold block">A</label><input id="ab" class="w-full p-1 border rounded text-center"></div>
                        </div>
                        <div><label class="text-[10px] font-bold text-slate-500 uppercase">Último Parto há</label><input id="ultimoParto" class="w-full p-2 border rounded-md bg-slate-50 uppercase"></div>
                        <div><label class="text-[10px] font-bold text-slate-500 uppercase">GBS</label><input id="gbs" class="w-full p-2 border rounded-md bg-slate-50 uppercase" value="NÃO REALIZADO"></div>
                        <div><label class="text-[10px] font-bold text-slate-500 uppercase">Maturação</label><input id="maturacao" class="w-full p-2 border rounded-md bg-slate-50 uppercase" value="NÃO REALIZADA"></div>
                    </div>
                </section>

                <section class="bg-blue-50/50 p-6 rounded-2xl border border-blue-100">
                    <div class="flex items-center gap-2 mb-4">
                        <i data-lucide="alert-circle" class="text-blue-700"></i>
                        <h2 class="text-lg font-bold text-blue-900 uppercase">Queixa e HDA</h2>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="text-[10px] font-bold text-blue-800 uppercase">Queixa Principal</label>
                            <input type="text" id="qp" class="w-full p-3 border border-blue-200 rounded-lg text-lg font-bold uppercase shadow-sm" placeholder="ex: SANGRAMENTO VAGINAL">
                        </div>
                        <div>
                            <label class="text-[10px] font-bold text-blue-800 uppercase">HDA</label>
                            <textarea id="hda" class="w-full p-3 border border-blue-200 rounded-lg h-32 text-sm uppercase" placeholder="Descreva o quadro atual..."></textarea>
                        </div>
                    </div>
                </section>

                <section>
                    <div class="flex items-center gap-2 mb-4 border-b pb-2 text-blue-900">
                        <span class="bg-blue-600 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold">3</span>
                        <h2 class="text-lg font-bold uppercase">Exame Físico</h2>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="space-y-4 bg-slate-50 p-4 rounded-xl">
                            <p class="text-[10px] font-bold text-slate-400 uppercase">Sinais Vitais</p>
                            <div class="grid grid-cols-2 gap-2">
                                <input id="pa_sist" class="p-2 border rounded text-center text-sm" placeholder="SIS">
                                <input id="pa_diast" class="p-2 border rounded text-center text-sm" placeholder="DIA">
                                <input id="fc_val" class="p-2 border rounded text-center text-sm" placeholder="FC">
                                <input id="tax_val" class="p-2 border rounded text-center text-sm" placeholder="TAX" value="AFEBRIL">
                            </div>
                            <input id="exameGeral" class="w-full p-2 border rounded text-xs uppercase" value="BEG, AAA, CORADA E HIDRATADA">
                        </div>
                        <div class="space-y-4 bg-slate-50 p-4 rounded-xl">
                            <p class="text-[10px] font-bold text-slate-400 uppercase">Obstétrico</p>
                            <div class="flex gap-2">
                                <div class="flex-1 text-center"><label class="text-[9px] font-bold block uppercase">AFU (cm)</label><input id="afu" class="w-full p-2 border rounded text-center font-bold"></div>
                                <div class="flex-1 text-center"><label class="text-[9px] font-bold block text-blue-600 uppercase">BCF (bpm)</label><input id="bcf" class="w-full p-2 border border-blue-400 rounded text-center font-bold text-blue-600"></div>
                            </div>
                            <input id="dinamica" class="w-full p-2 border rounded text-xs uppercase" placeholder="DINÂMICA" value="AUSENTE">
                        </div>
                        <div class="space-y-4">
                            <p class="text-[10px] font-bold text-slate-400 uppercase">Ginecológico</p>
                            <textarea id="especular" class="w-full p-2 border rounded text-[10px] h-12 uppercase" placeholder="ESPECULAR">COLO TRÓFICO, ORIFÍCIO EXTERNO PUNTIFORME. CONTEÚDO FISIOLÓGICO.</textarea>
                            <textarea id="tv" class="w-full p-2 border rounded text-[10px] h-12 uppercase" placeholder="TOQUE VAGINAL">COLO POSTERIOR, IMPÉRVIO, GROSSO.</textarea>
                        </div>
                    </div>
                </section>
            </div>

            <!-- ABA DOCUMENTOS -->
            <div id="content-documentos" class="hidden space-y-8 animate-in">
                <!-- ÁREA DE COLAGEM MÁGICA -->
                <section class="bg-indigo-900 p-6 rounded-2xl text-white shadow-xl relative overflow-hidden">
                    <div class="relative z-10">
                        <div class="flex items-center gap-2 mb-2">
                            <i data-lucide="sparkles" class="text-indigo-300"></i>
                            <h3 class="font-bold uppercase tracking-widest text-sm">Área de Colagem Mágica ✨</h3>
                        </div>
                        <p class="text-indigo-200 text-[10px] mb-3 uppercase">Copie o texto do prontuário/PDF e cole abaixo para preencher tudo instantaneamente.</p>
                        <textarea id="magic-paste" class="w-full p-3 bg-indigo-800 border border-indigo-700 rounded-lg text-xs h-24 text-indigo-100 placeholder-indigo-400 outline-none focus:ring-2 focus:ring-indigo-400 transition-all" placeholder="COLE O TEXTO DO PRONTUÁRIO AQUI..."></textarea>
                        <div class="flex justify-end mt-2">
                            <button onclick="parseClinicalData()" id="parse-btn" class="bg-indigo-500 hover:bg-indigo-400 text-white px-6 py-2 rounded-lg text-[10px] font-black flex items-center gap-2 shadow-lg transition-all">
                                <i data-lucide="zap" class="w-3 h-3"></i> LER E PREENCHER FORMULÁRIO
                            </button>
                        </div>
                    </div>
                    <div class="absolute top-0 right-0 opacity-10 pointer-events-none">
                        <i data-lucide="bot" style="width: 150px; height: 150px;"></i>
                    </div>
                </section>

                <section class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-6">
                        <div class="bg-slate-50 p-4 rounded-xl border border-slate-200">
                            <div class="flex items-center gap-2 mb-3 text-blue-800">
                                <i data-lucide="file-search" class="w-5 h-5"></i>
                                <h3 class="text-sm font-bold uppercase tracking-tight">Síntese do Prontuário</h3>
                            </div>
                            <textarea id="resumo_pdf" class="w-full p-2 border rounded text-xs h-24 uppercase" placeholder="Resumo do encaminhamento ou consultas anteriores..."></textarea>
                        </div>
                        <div class="bg-slate-50 p-4 rounded-xl border border-slate-200">
                            <div class="flex items-center gap-2 mb-3 text-blue-800">
                                <i data-lucide="beaker" class="w-5 h-5"></i>
                                <h3 class="text-sm font-bold uppercase tracking-tight">Laboratórios</h3>
                            </div>
                            <textarea id="labs_int" class="w-full p-2 border rounded text-xs h-32 font-mono uppercase" placeholder="HB/HT, LEUCO, PLAQ, PCR, EAS..."></textarea>
                        </div>
                    </div>
                    <div class="space-y-6">
                        <div class="bg-blue-50/30 p-4 rounded-xl border border-blue-100">
                            <div class="flex items-center gap-2 mb-3 text-blue-900 font-bold uppercase text-sm">
                                <i data-lucide="file-search" class="w-5 h-5"></i> Ultrassonografia
                            </div>
                            <textarea id="usg_detalhes" class="w-full p-2 border border-blue-200 rounded text-xs h-32 uppercase" placeholder="IG, PFE, ILA, PLACENTA, DOPPLER..."></textarea>
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <div><label class="text-[9px] font-bold uppercase">TS</label><input id="ts" class="w-full p-2 border rounded text-xs uppercase"></div>
                            <div><label class="text-[9px] font-bold uppercase">GJ</label><input id="gj" class="w-full p-2 border rounded text-xs uppercase"></div>
                        </div>
                        <textarea id="comorbidades" class="w-full p-2 border rounded text-xs h-16 uppercase" placeholder="COMORBIDADES E MUC...">NEGA</textarea>
                    </div>
                </section>
            </div>

            <!-- IA BOX -->
            <div id="ai-box" class="hidden bg-indigo-50 border-2 border-indigo-200 rounded-2xl p-6 relative overflow-hidden animate-in">
                <div class="flex items-center gap-2 mb-4 text-indigo-900 font-black uppercase text-sm">
                    <i data-lucide="sparkles" class="w-5 h-5"></i> Sugestão Assistida ✨
                </div>
                <div id="ai-content" class="text-sm text-indigo-950 whitespace-pre-wrap leading-relaxed italic"></div>
                <button onclick="document.getElementById('ai-box').classList.add('hidden')" class="mt-4 text-[10px] font-bold text-indigo-400 uppercase underline">Fechar</button>
            </div>

            <!-- CONCLUSÃO -->
            <section class="bg-slate-900 text-white p-6 rounded-2xl shadow-2xl space-y-6">
                <div class="flex justify-between items-center border-b border-slate-700 pb-2">
                    <h2 class="text-sm font-bold uppercase tracking-widest text-blue-400 flex items-center gap-2">
                        <i data-lucide="check-circle" class="w-4 h-4"></i> Conclusão e Conduta
                    </h2>
                    <div class="flex gap-2">
                        <button onclick="callAI('diagnosis')" class="bg-emerald-700 hover:bg-emerald-600 px-3 py-1.5 rounded-lg text-[10px] font-bold flex items-center gap-1">
                            <i data-lucide="sparkles" class="w-3 h-3"></i> Sugerir Conduta ✨
                        </button>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <label class="text-[10px] font-bold text-slate-400 uppercase">Hipótese Diagnóstica</label>
                        <input id="hd_final" class="w-full bg-slate-800 border-b border-slate-600 p-2 text-xl font-black text-red-400 uppercase outline-none" placeholder="DIAGNÓSTICO...">
                        <label class="text-[10px] font-bold text-slate-400 uppercase block mt-2">Staff</label>
                        <input id="staff" class="w-full bg-slate-800 border border-slate-700 rounded p-2 text-sm uppercase" placeholder="DR(A)...">
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 uppercase">Plano de Conduta</label>
                        <textarea id="conduta_final" class="w-full bg-slate-800 border border-slate-700 rounded p-3 text-sm h-32 outline-none uppercase" placeholder="Plano terapêutico..."></textarea>
                    </div>
                </div>
                <button onclick="generateFinal()" class="w-full py-4 bg-blue-600 hover:bg-blue-500 text-white font-black text-lg rounded-xl flex items-center justify-center gap-3 uppercase shadow-lg">
                    <i data-lucide="refresh-ccw" class="w-5 h-5"></i> Gerar Evolução para Prontuário
                </button>
            </section>

            <!-- RESULTADO FINAL -->
            <div id="result-box" class="hidden space-y-2 animate-in">
                <div class="bg-slate-200 px-6 py-2 flex justify-between items-center rounded-t-xl">
                    <span class="text-[10px] font-bold text-slate-600 uppercase tracking-tighter">Evolução Formatada</span>
                    <button onclick="copyToClipboard()" id="copy-btn" class="bg-blue-700 hover:bg-blue-600 text-white px-4 py-1 rounded-lg text-[10px] font-bold">COPIAR TEXTO</button>
                </div>
                <div class="bg-white border-2 border-slate-200 p-8 rounded-b-xl shadow-inner overflow-x-auto">
                    <pre id="final-text" class="text-slate-800 font-mono text-[12px] whitespace-pre-wrap select-all"></pre>
                </div>
            </div>

        </main>
    </div>

    <script>
        // Configuração Gemini - API KEY VAZIA (SISTEMA PREENCHE NO RUNTIME)
        const API_KEY = ""; 

        // Inicialização de ícones
        lucide.createIcons();
        document.getElementById('current-date').innerText = new Date().toLocaleDateString('pt-BR');

        // Navegação de Abas
        function switchTab(tab) {
            const btnClinica = document.getElementById('tab-clinica');
            const btnDocumentos = document.getElementById('tab-documentos');
            const contentClinica = document.getElementById('content-clinica');
            const contentDocumentos = document.getElementById('content-documentos');

            if (tab === 'clinica') {
                btnClinica.className = "flex-1 py-4 text-sm font-bold uppercase tracking-wider flex items-center justify-center gap-2 bg-blue-50 text-blue-800 border-b-4 border-blue-600";
                btnDocumentos.className = "flex-1 py-4 text-sm font-bold uppercase tracking-wider flex items-center justify-center gap-2 text-slate-400 border-b-4 border-transparent hover:text-slate-600";
                contentClinica.classList.remove('hidden');
                contentDocumentos.classList.add('hidden');
            } else {
                btnDocumentos.className = "flex-1 py-4 text-sm font-bold uppercase tracking-wider flex items-center justify-center gap-2 bg-blue-50 text-blue-800 border-b-4 border-blue-600";
                btnClinica.className = "flex-1 py-4 text-sm font-bold uppercase tracking-wider flex items-center justify-center gap-2 text-slate-400 border-b-4 border-transparent hover:text-slate-600";
                contentDocumentos.classList.remove('hidden');
                contentClinica.classList.add('hidden');
            }
        }

        // FUNÇÃO MÁGICA: Extrair dados do texto colado via Gemini
        async function parseClinicalData() {
            const rawText = document.getElementById('magic-paste').value;
            if(!rawText) return;

            const btn = document.getElementById('parse-btn');
            const originalHtml = btn.innerHTML;
            btn.innerHTML = `<i data-lucide="loader-2" class="w-3 h-3 animate-spin"></i> LENDO PDF...`;
            btn.disabled = true;
            lucide.createIcons();

            const prompt = `Você é um assistente médico especialista. Extraia os dados clínicos do seguinte texto de prontuário e retorne APENAS um objeto JSON. 
            Mapeie para estas chaves: nome, idade, prontuario, ge, pa_n, pa_c, ab, ultimoParto, ig_semanas, ig_dias, ts, gj, comorbidades, qp, hda, labs_int, usg_detalhes.
            Texto: ${rawText}`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        contents: [{parts: [{text: prompt}]}],
                        generationConfig: { responseMimeType: "application/json" }
                    })
                });
                
                const data = await response.json();
                const clinicalData = JSON.parse(data.candidates[0].content.parts[0].text);

                // Preencher campos
                if(clinicalData.nome) document.getElementById('nome').value = clinicalData.nome;
                if(clinicalData.idade) document.getElementById('idade').value = clinicalData.idade;
                if(clinicalData.prontuario) document.getElementById('prontuario').value = clinicalData.prontuario;
                if(clinicalData.ge) document.getElementById('ge').value = clinicalData.ge;
                if(clinicalData.pa_n) document.getElementById('pa_n').value = clinicalData.pa_n;
                if(clinicalData.pa_c) document.getElementById('pa_c').value = clinicalData.pa_c;
                if(clinicalData.ab) document.getElementById('ab').value = clinicalData.ab;
                if(clinicalData.ultimoParto) document.getElementById('ultimoParto').value = clinicalData.ultimoParto;
                if(clinicalData.ig_semanas) document.getElementById('ig_semanas') ? document.getElementById('ig_semanas').value = clinicalData.ig_semanas : null; // se houver campo
                if(clinicalData.ts) document.getElementById('ts').value = clinicalData.ts;
                if(clinicalData.gj) document.getElementById('gj').value = clinicalData.gj;
                if(clinicalData.comorbidades) document.getElementById('comorbidades').value = clinicalData.comorbidades;
                if(clinicalData.qp) document.getElementById('qp').value = clinicalData.qp;
                if(clinicalData.hda) document.getElementById('hda').value = clinicalData.hda;
                if(clinicalData.labs_int) document.getElementById('labs_int').value = clinicalData.labs_int;
                if(clinicalData.usg_detalhes) document.getElementById('usg_detalhes').value = clinicalData.usg_detalhes;

                btn.innerHTML = `<i data-lucide="check" class="w-3 h-3"></i> PREENCHIDO!`;
                btn.className = "bg-green-500 text-white px-6 py-2 rounded-lg text-[10px] font-black flex items-center gap-2 shadow-lg";
                setTimeout(() => {
                    btn.innerHTML = originalHtml;
                    btn.className = "bg-indigo-500 hover:bg-indigo-400 text-white px-6 py-2 rounded-lg text-[10px] font-black flex items-center gap-2 shadow-lg transition-all";
                    btn.disabled = false;
                    lucide.createIcons();
                }, 2000);

            } catch (e) {
                console.error(e);
                btn.innerHTML = `<i data-lucide="x" class="w-3 h-3"></i> ERRO NA LEITURA`;
                btn.className = "bg-red-500 text-white px-6 py-2 rounded-lg text-[10px] font-black flex items-center gap-2 shadow-lg";
                setTimeout(() => {
                    btn.innerHTML = originalHtml;
                    btn.className = "bg-indigo-500 hover:bg-indigo-400 text-white px-6 py-2 rounded-lg text-[10px] font-black flex items-center gap-2 shadow-lg transition-all";
                    btn.disabled = false;
                    lucide.createIcons();
                }, 2000);
            }
        }

        // Função de Geração Final
        function generateFinal() {
            const getVal = (id) => document.getElementById(id).value.toUpperCase();
            
            const text = `## URGÊNCIA OBSTETRÍCIA MATERNIDADE - DATA ${new Date().toLocaleDateString('pt-BR')} ###

- NOME: ${getVal('nome')}
- IDADE: ${getVal('idade')} ANOS
- PRONTUÁRIO: ${getVal('prontuario')}
- PARIDADE: G${getVal('ge')} P${getVal('pa_n')}N${getVal('pa_c')}C A${getVal('ab')}
   >> ÚLTIMO PARTO: ${getVal('ultimoParto')}
   >> CURETAGEM: ${getVal('ab') > 0 ? 'SIM' : 'NEGA'}
- IG: ${getVal('afu')} CM (A.F.) | GBS: ${getVal('gbs')} | MATURAÇÃO: ${getVal('maturacao')}
- TS: ${getVal('ts')} | GJ: ${getVal('gj')}
- COMORBIDADES: ${getVal('comorbidades')}

# QP: "${getVal('qp')}"

# HDA: ${getVal('hda')}

# HD: NEGA: SANGRAMENTOS, METROSSISTOLES, CORRIMENTO VAGINAL, PERDAS VAGINAIS, QUEIXAS URINARIAS.

# EXAME FÍSICO: 
- ${getVal('exameGeral')}
- SINAIS VITAIS: PA: ${getVal('pa_sist')}X${getVal('pa_diast')} MMHG / FC: ${getVal('fc_val')} BPM / TAX: ${getVal('tax_val')}
- AR: MV+, SRA, SEM SINAIS DE DESCONFORTO RESPIRATÓRIO
- ABD: ABDOME GRAVIDICO, SEM DOR A PALPAÇÃO, RHA+, DB NEGATIVA.
- DINAMICA UTERINA: ${getVal('dinamica')}
- AFU: ${getVal('afu')} CM; AL FISIOLOGICO
- BCF: ${getVal('bcf')} BPM - SEM DESACELERAÇÕES
- ESPECULAR: ${getVal('especular')}
- TV: ${getVal('tv')}

# EXAMES COMPLEMENTARES:
${getVal('resumo_pdf') ? `>> SÍNTESE DO ENCAMINHAMENTO/PRÉ-NATAL <<\n- ${getVal('resumo_pdf')}\n` : ""}${getVal('labs_int') ? `>> LABORATORIAIS <<\n- ${getVal('labs_int')}\n` : ""}>> USG <<
- ${getVal('usg_detalhes')}

# HD: 
- ${getVal('hd_final')}

# CONDUTA DISCUTIDA E ORIENTADA POR STAFF DR(A) ${getVal('staff')}
- ${getVal('conduta_final')}`;

            document.getElementById('final-text').innerText = text;
            document.getElementById('result-box').classList.remove('hidden');
            document.getElementById('result-box').scrollIntoView({ behavior: 'smooth' });
        }

        function copyToClipboard() {
            const text = document.getElementById('final-text').innerText;
            const textArea = document.createElement("textarea");
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            
            const btn = document.getElementById('copy-btn');
            btn.innerText = "COPIADO!";
            btn.className = "bg-green-600 text-white px-4 py-1 rounded-lg text-[10px] font-bold";
            setTimeout(() => {
                btn.innerText = "COPIAR TEXTO";
                btn.className = "bg-blue-700 hover:bg-blue-600 text-white px-4 py-1 rounded-lg text-[10px] font-bold";
            }, 2000);
        }

        // Suporte à Decisão (Gemini)
        async function callAI(type) {
            if(!API_KEY) { alert("Chave de API necessária."); return; }

            const box = document.getElementById('ai-box');
            const content = document.getElementById('ai-content');
            box.classList.remove('hidden');
            content.innerText = "Consultando inteligência obstétrica...";

            const prompt = `Paciente IG: ${document.getElementById('afu').value}, QP: ${document.getElementById('qp').value}, HDA: ${document.getElementById('hda').value}. Sinais Vitais: ${document.getElementById('pa_sist').value}x${document.getElementById('pa_diast').value}. Sugira hipóteses e condutas baseadas na FEBRASGO.`;

            try {
                const resp = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        contents: [{parts: [{text: prompt}]}],
                        systemInstruction: {parts: [{text: "Você é um obstetra experiente. Responda em tópicos curtos e práticos."}]}
                    })
                });
                const data = await resp.json();
                content.innerText = data.candidates[0].content.parts[0].text;
            } catch (e) {
                content.innerText = "Erro ao conectar com a IA.";
            }
        }
    </script>
</body>
</html>
