<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MedAssist GO - Plantão Obstétrico & Round</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Mammoth.js para ler DOCX -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            color: #334155;
        }

        .hidden {
            display: none !important;
        }

        .active-tab {
            border-bottom: 2px solid #2563eb;
            color: #1e40af;
            background-color: #eff6ff;
        }

        .active-module {
            background-color: #1e293b;
            color: white;
        }

        .input-field {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            background-color: #ffffff;
            transition: all 0.2s;
            text-transform: uppercase;
        }

        .input-field:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .label-text {
            font-size: 0.7rem;
            font-weight: 700;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.025em;
            margin-bottom: 0.25rem;
            display: block;
        }

        .card {
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            border: 1px solid #e2e8f0;
        }

        .btn-primary {
            background-color: #2563eb;
            color: white;
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: background-color 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            justify-content: center;
        }

        .btn-primary:hover {
            background-color: #1d4ed8;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
            color: #475569;
            font-weight: 600;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 0.25rem;
        }

        .checkbox-group label:hover {
            background-color: #f1f5f9;
        }

        /* Loading Animation */
        .typing-indicator span {
            display: inline-block;
            width: 4px;
            height: 4px;
            background-color: #3b82f6;
            border-radius: 50%;
            animation: typing 1s infinite;
            margin: 0 2px;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-4px);
            }
        }
    </style>
</head>

<body class="p-2 md:p-6 min-h-screen">

    <!-- TOP NAVIGATION -->
    <nav
        class="max-w-7xl mx-auto mb-6 flex justify-between items-center bg-white p-2 rounded-xl shadow-sm border border-slate-200 sticky top-2 z-50">
        <div class="flex items-center gap-4">
            <img src="https://i.postimg.cc/zvZch7RF/D9233933-7ECF-4893-9A6F-C8DA69D360A2.png"
                class="h-10 w-auto rounded-md shadow-sm border border-slate-100" alt="MedAssist Logo">
            <div class="h-8 w-px bg-slate-200 hidden md:block"></div>
            <div class="flex gap-2">
                <button onclick="switchModule('admissao')" id="mod-admissao"
                    class="px-4 py-2 rounded-lg text-xs font-bold uppercase transition-all active-module">
                    <i data-lucide="clipboard-list" class="inline w-4 h-4 mr-2"></i> Admissão
                </button>
                <button onclick="switchModule('round')" id="mod-round"
                    class="px-4 py-2 rounded-lg text-xs font-bold uppercase transition-all text-slate-500 hover:bg-slate-50">
                    <i data-lucide="repeat" class="inline w-4 h-4 mr-2"></i> Round / Evolução
                </button>
            </div>
        </div>
        <div class="text-xs font-mono text-slate-400 flex items-center gap-2">
            <span id="cloud-status">☁️ Offline</span>
        </div>
    </nav>

    <!-- MÓDULO DE ADMISSÃO -->
    <div id="module-admissao" class="max-w-7xl mx-auto space-y-6">
        <!-- HEADER ADMISSÃO -->
        <header class="card p-5 flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="flex items-center gap-3">
                <div class="bg-blue-50 p-2 rounded-lg"><i data-lucide="activity" class="text-blue-600 w-6 h-6"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold text-slate-800 tracking-tight">MedAssist GO</h1>
                    <p class="text-xs text-slate-500 font-semibold uppercase" id="header-subtitle">Urgência Obstétrica
                    </p>
                </div>
            </div>
            <div class="flex bg-slate-100 p-1 rounded-lg">
                <button onclick="setMode('OBST')" id="btn-obst"
                    class="px-5 py-2 rounded-md text-xs font-bold transition-all bg-white text-blue-700 shadow-sm border border-slate-200">OBSTETRÍCIA</button>
                <button onclick="setMode('GYN')" id="btn-gyn"
                    class="px-5 py-2 rounded-md text-xs font-bold transition-all text-slate-500 hover:text-slate-700">GINECOLOGIA</button>
            </div>
        </header>

        <!-- SUB-NAVEGAÇÃO ADMISSÃO -->
        <nav class="flex overflow-x-auto bg-white border border-slate-200 rounded-lg shadow-sm">
            <button onclick="showTab('id')"
                class="flex-1 py-4 px-6 text-xs font-bold uppercase whitespace-nowrap active-tab nav-btn flex items-center justify-center gap-2"
                id="nav-id"><i data-lucide="user" class="w-3 h-3"></i> Identificação</button>
            <button onclick="showTab('anamnese')"
                class="flex-1 py-4 px-6 text-xs font-bold uppercase whitespace-nowrap nav-btn flex items-center justify-center gap-2"
                id="nav-anamnese"><i data-lucide="message-square" class="w-3 h-3"></i> Anamnese ✨</button>
            <button onclick="showTab('exame')"
                class="flex-1 py-4 px-6 text-xs font-bold uppercase whitespace-nowrap nav-btn flex items-center justify-center gap-2"
                id="nav-exame"><i data-lucide="stethoscope" class="w-3 h-3"></i> Exame Físico</button>
            <button onclick="showTab('docs')"
                class="flex-1 py-4 px-6 text-xs font-bold uppercase whitespace-nowrap nav-btn flex items-center justify-center gap-2"
                id="nav-docs"><i data-lucide="file-text" class="w-3 h-3"></i> Docs & IA</button>
            <button onclick="showTab('final')"
                class="flex-1 py-4 px-6 text-xs font-bold uppercase whitespace-nowrap bg-slate-800 text-white hover:bg-slate-700 nav-btn flex items-center justify-center gap-2"
                id="nav-final"><i data-lucide="file-check" class="w-3 h-3"></i> Gerar Prontuário</button>
        </nav>

        <!-- CONTEÚDO ADMISSÃO -->
        <main class="card p-6 md:p-8 min-h-[600px]">
            <!-- 1. IDENTIFICAÇÃO -->
            <section id="tab-id" class="grid grid-cols-1 md:grid-cols-4 gap-5 animate-in">
                <div class="md:col-span-2"><label class="label-text">Nome Completo</label><input id="nome"
                        class="input-field" placeholder="NOME DA PACIENTE"></div>
                <div><label class="label-text">Idade</label><input id="idade" class="input-field"></div>
                <div><label class="label-text">Prontuário</label><input id="prontuario" class="input-field"></div>
                <div
                    class="md:col-span-4 grid grid-cols-1 md:grid-cols-4 gap-5 obst-field border-t border-b border-slate-100 py-4 bg-slate-50/50 rounded-lg px-2">
                    <div class="md:col-span-4 text-xs font-bold text-blue-600 mb-[-10px]">DADOS OBSTÉTRICOS</div>
                    <div><label class="label-text">G P A</label><input id="gpa" class="input-field"
                            placeholder="G_ P_ A_"></div>
                    <div><label class="label-text">Último Parto/Cesárea</label><input id="ultimo_parto"
                            class="input-field"></div>
                    <div><label class="label-text">Filhos Vivos</label><input id="filhos_vivos" class="input-field">
                    </div>
                    <div><label class="label-text">Curetagem</label><input id="curetagem" class="input-field"></div>
                    <div class="md:col-span-2"><label class="label-text">IG (USG Data e IG)</label><input id="ig_usg"
                            class="input-field"></div>
                    <div class="md:col-span-2"><label class="label-text">TS | TOXO | GJ | TOTG</label><input
                            id="labs_triagem" class="input-field"></div>
                    <div><label class="label-text">Consultas PN</label><input id="pn_count" class="input-field"></div>
                    <div><label class="label-text">GBS</label><input id="gbs" class="input-field"></div>
                    <div class="md:col-span-2"><label class="label-text">Maturação</label><input id="maturacao"
                            class="input-field"></div>
                </div>
                <!-- ... Outros campos Admissão ... -->
                <div
                    class="md:col-span-4 grid grid-cols-1 md:grid-cols-4 gap-5 gyn-field hidden border-t border-b border-slate-100 py-4 bg-pink-50/30 rounded-lg px-2">
                    <div class="md:col-span-4 text-xs font-bold text-pink-600 mb-[-10px]">ANTECEDENTES
                        GINECO-OBSTÉTRICOS</div>
                    <div><label class="label-text">G P A</label><input id="gpa_gyn" class="input-field"></div>
                    <div><label class="label-text">DUM</label><input id="dum" class="input-field"></div>
                    <div><label class="label-text">Sexarca</label><input id="sexarca" class="input-field"></div>
                    <div><label class="label-text">Método Contraceptivo</label><input id="mac" class="input-field">
                    </div>
                </div>
                <div class="md:col-span-4"><label class="label-text">Comorbidades</label><input id="comorbidades"
                        class="input-field" value="NEGA"></div>
                <div class="md:col-span-2"><label class="label-text">MUC</label><input id="muc" class="input-field"
                        value="NEGA"></div>
                <div class="md:col-span-2"><label class="label-text">Alergias</label><input id="alergias"
                        class="input-field" value="NEGA"></div>
                <div class="md:col-span-2"><label class="label-text">Cirurgias Prévias</label><input id="cirurgias"
                        class="input-field"></div>
                <div class="md:col-span-2 obst-field"><label class="label-text">Hábitos</label><input id="habitos"
                        class="input-field" value="NEGA"></div>
            </section>
            <!-- 2. ANAMNESE INTELIGENTE -->
            <section id="tab-anamnese" class="hidden grid grid-cols-1 md:grid-cols-2 gap-6 animate-in">
                <div class="space-y-4">
                    <div>
                        <label class="label-text text-blue-700">QUEIXA PRINCIPAL (QP)</label>
                        <div class="relative">
                            <input id="qp" class="input-field font-bold border-blue-200 bg-blue-50/30 text-lg py-3"
                                placeholder="Ex: SANGRAMENTO VAGINAL" onblur="generateQuestions()">
                            <button onclick="generateQuestions()"
                                class="absolute right-2 top-2 p-1.5 bg-blue-100 rounded text-blue-600 hover:bg-blue-200 transition"><i
                                    data-lucide="sparkles" class="w-4 h-4"></i></button>
                        </div>
                    </div>
                    <div id="ai-questions-box"
                        class="hidden border border-blue-100 bg-blue-50/50 rounded-xl p-4 transition-all">
                        <div id="questions-list" class="space-y-3 text-xs"></div>
                        <button onclick="generateAnamnesisText()"
                            class="w-full mt-4 btn-primary text-xs py-2 shadow-sm"><i data-lucide="pen-tool"
                                class="w-3 h-3"></i> GERAR TEXTO DA HDA</button>
                    </div>
                </div>
                <div class="space-y-4">
                    <div class="h-full flex flex-col"><label class="label-text text-blue-700">HISTÓRIA DA DOENÇA ATUAL
                            (HDA)</label><textarea id="hda"
                            class="input-field flex-grow resize-none font-medium leading-relaxed text-slate-700 bg-white shadow-inner"
                            style="min-height: 300px;"></textarea></div>
                </div>
                <div class="md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-slate-100">
                    <div class="obst-field w-full"><label class="label-text">HD (Negativas)</label><input id="hd_neg"
                            class="input-field"
                            value="NEGA: SANGRAMENTOS, METROSSISTOLES, CORRIMENTO VAGINAL, PERDAS VAGINAIS."></div>
                    <div class="gyn-field hidden w-full space-y-4">
                        <div><label class="label-text">IS - Urinárias</label><input id="is_urinarias"
                                class="input-field" value="NEGA: DISURIA, POLACIURIA"></div>
                        <div><label class="label-text">Queixas Ginecológicas</label><input id="queixas_gyn"
                                class="input-field" value="NEGA: CORRIMENTOS, SINUSORRAGIA"></div>
                    </div>
                </div>
            </section>
            <!-- 3. EXAME FÍSICO -->
            <section id="tab-exame" class="hidden grid grid-cols-1 md:grid-cols-2 gap-5 animate-in">
                <div class="md:col-span-2 bg-slate-50 p-4 rounded-lg border border-slate-100">
                    <label class="label-text">Estado Geral</label><input id="ef_geral" class="input-field mb-3"
                        value="BEG, AAA, CORADA E HIDRATADA">
                    <div class="grid grid-cols-3 gap-3">
                        <div><label class="label-text">PA (mmHg)</label><input id="pa" class="input-field text-center">
                        </div>
                        <div><label class="label-text">FC (bpm)</label><input id="fc" class="input-field text-center">
                        </div>
                        <div><label class="label-text">SAT (%)</label><input id="sat" class="input-field text-center">
                        </div>
                    </div>
                </div>
                <div><label class="label-text">ACV</label><input id="acv" class="input-field" value="RCR, 2T, BNF, SS">
                </div>
                <div><label class="label-text">AR</label><input id="ar" class="input-field"
                        value="MV+, SRA, SEM SINAIS DE DESCONFORTO"></div>
                <div class="md:col-span-2"><label class="label-text">Abdome</label><input id="abd" class="input-field"
                        value="ABDOME GRAVIDICO, SEM DOR A PALPAÇÃO, RHA+, DB NEGATIVA."></div>
                <div class="obst-field"><label class="label-text">Dinâmica</label><input id="dinamica"
                        class="input-field" value="AUSENTE"></div>
                <div class="obst-field"><label class="label-text">AFU (cm)</label><input id="afu"
                        class="input-field text-center font-bold"></div>
                <div class="obst-field"><label class="label-text text-blue-600">BCF (bpm)</label><input id="bcf"
                        class="input-field text-center font-bold text-blue-600 border-blue-200"></div>
                <div class="obst-field"><label class="label-text">Mov. Fetais</label><input id="mf" class="input-field"
                        value="PRESENTES"></div>
                <div class="md:col-span-1"><label class="label-text">Especular</label><textarea id="especular"
                        class="input-field h-20">COLO TRÓFICO, ORIFÍCIO EXTERNO PUNTIFORME.</textarea></div>
                <div class="md:col-span-1"><label class="label-text">Toque Vaginal</label><textarea id="tv"
                        class="input-field h-20">COLO POSTERIOR, IMPERVIO, GROSSO.</textarea></div>
                <div class="md:col-span-2"><label class="label-text">MMII</label><input id="mmii" class="input-field"
                        value="AUSÊNCIA DE EDEMA."></div>
            </section>
            <!-- 4. DOCS -->
            <section id="tab-docs" class="hidden space-y-6 animate-in">
                <div
                    class="border-2 border-dashed border-blue-200 bg-blue-50 rounded-xl p-8 text-center relative cursor-pointer group">
                    <input type="file" id="file-input" class="absolute inset-0 opacity-0 cursor-pointer z-10"
                        onchange="processFile()" accept="image/*,application/pdf">
                    <div class="pointer-events-none">
                        <i data-lucide="scan-line"
                            class="w-12 h-12 text-blue-400 mx-auto mb-3 group-hover:scale-110 transition-transform"></i>
                        <h3 class="text-sm font-bold text-blue-800 uppercase">Leitura Mágica de Documentos</h3>
                        <p class="text-xs text-blue-500 mt-1">Arraste PDF ou Foto aqui.</p>
                        <div id="ai-status"
                            class="mt-4 text-xs font-mono text-blue-600 hidden bg-white px-3 py-1 rounded-full inline-block shadow-sm">
                            Processando...</div>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    <div class="obst-field md:col-span-2"><label class="label-text">APAE I
                            (Data/Resumo)</label><textarea id="apae1" class="input-field h-20"></textarea></div>
                    <div class="obst-field md:col-span-2"><label class="label-text">APAE II
                            (Data/Resumo)</label><textarea id="apae2" class="input-field h-20"></textarea></div>
                    <div class="obst-field"><label class="label-text">USG 1T</label><input id="usg_1t"
                            class="input-field"></div>
                    <div class="obst-field"><label class="label-text">USG Morfológico</label><input id="usg_morf"
                            class="input-field"></div>
                    <div class="md:col-span-2"><label class="label-text">Exames Gerais</label><textarea id="exames_comp"
                            class="input-field h-32"></textarea></div>
                </div>
            </section>
            <!-- 5. FINAL -->
            <section id="tab-final" class="hidden space-y-6 animate-in">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    <div class="obst-field md:col-span-2"><label class="label-text">Plano de Parto</label><input
                            id="plano_parto" class="input-field"></div>
                    <div class="obst-field md:col-span-2"><label class="label-text">Gestação Tópica IG</label><input
                            id="gestacao_ig" class="input-field"></div>
                    <div><label class="label-text">Staff Responsável</label><input id="staff" class="input-field"></div>
                    <div class="md:col-span-2"><label class="label-text">Conduta</label><textarea id="conduta"
                            class="input-field h-24"></textarea></div>
                </div>
                <div class="bg-slate-900 p-6 rounded-xl shadow-2xl mt-4 border border-slate-700">
                    <div class="flex justify-between items-center mb-4 border-b border-slate-700 pb-4">
                        <span
                            class="text-xs font-bold text-slate-400 uppercase tracking-wider flex items-center gap-2"><i
                                data-lucide="file-check" class="w-4 h-4"></i> Resultado Final</span>
                        <button onclick="generateOutput()"
                            class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg text-xs font-bold transition-colors flex items-center gap-2"><i
                                data-lucide="refresh-cw" class="w-3 h-3"></i> ATUALIZAR</button>
                    </div>
                    <textarea id="final-text"
                        class="w-full h-96 bg-slate-800 text-slate-300 font-mono text-xs p-4 rounded-lg outline-none resize-none leading-relaxed border border-slate-700"
                        readonly></textarea>
                    <button onclick="copyToClipboard()"
                        class="w-full bg-emerald-600 hover:bg-emerald-500 text-white font-bold py-4 rounded-lg mt-4 uppercase text-sm shadow-lg flex items-center justify-center gap-2 transition-transform active:scale-[0.99]"><i
                            data-lucide="copy" class="w-5 h-5"></i> COPIAR</button>
                </div>
            </section>
        </main>
    </div>

    <!-- MÓDULO DE ROUND / EVOLUÇÃO (NOVO) -->
    <div id="module-round" class="max-w-7xl mx-auto hidden grid grid-cols-1 lg:grid-cols-4 gap-6">
        <!-- SIDEBAR -->
        <aside class="lg:col-span-1 space-y-4">

            <!-- IMPORTAÇÃO MÁGICA PASSÔMETRO -->
            <div
                class="card p-4 bg-indigo-600 border-indigo-700 text-white text-center shadow-lg relative cursor-pointer overflow-hidden group hover:bg-indigo-700 transition">
                <input type="file" id="import-passometro" class="absolute inset-0 opacity-0 cursor-pointer z-10"
                    accept=".pdf,.docx" onchange="importRound(this)">
                <div id="import-content">
                    <i data-lucide="file-spreadsheet" class="w-8 h-8 mx-auto mb-2 text-indigo-200 animate-pulse"></i>
                    <h3 class="text-xs font-extrabold uppercase tracking-wide">Importar Passômetro</h3>
                    <p class="text-[10px] text-indigo-200 mt-1">Word® (.docx) ou PDF da Maternidade</p>
                </div>
                <!-- Loading State Overlay -->
                <div id="import-loading"
                    class="hidden absolute inset-0 bg-indigo-800 flex flex-col items-center justify-center z-20">
                    <i data-lucide="loader-2" class="w-8 h-8 text-white animate-spin mb-3"></i>
                    <p class="text-[10px] font-bold text-white tracking-widest animate-pulse">A LER TABELA DE
                        PACIENTES...</p>
                </div>
            </div>

            <div class="card p-4 bg-slate-50 border-slate-200">
                <h3 class="text-xs font-bold text-slate-500 uppercase mb-3"><i data-lucide="user-plus"
                        class="inline w-3 h-3 mr-1"></i> Nova Paciente</h3>
                <div class="space-y-2">
                    <input id="round-leito" class="input-field text-xs" placeholder="LEITO (Ex: 04)">
                    <input id="round-nome" class="input-field text-xs" placeholder="NOME COMPLETO">
                    <select id="round-tipo" class="input-field text-xs uppercase font-bold">
                        <option value="gestante">GESTANTE</option>
                        <option value="puerpera">PUÉRPERA</option>
                    </select>
                    <button onclick="addPatient()" class="w-full btn-primary text-xs py-2 shadow-sm">ADICIONAR AO
                        ROUND</button>
                </div>
            </div>
            <div class="card p-4 h-[500px] overflow-y-auto">
                <h3 class="text-xs font-bold text-slate-500 uppercase mb-3">Em Acompanhamento</h3>
                <div id="patient-list" class="space-y-2">
                    <div class="text-center text-xs text-slate-400 py-4">Nenhuma paciente no round hoje.</div>
                </div>
            </div>
        </aside>

        <!-- AREA PRINCIPAL EVOLUÇÃO -->
        <main class="lg:col-span-3 card p-6 min-h-[600px]">
            <div id="evolution-empty" class="h-full flex flex-col items-center justify-center text-slate-300">
                <i data-lucide="clipboard-edit" class="w-16 h-16 mb-4 opacity-50"></i>
                <p class="font-bold">SELECIONE UMA PACIENTE PARA EVOLUIR</p>
            </div>
            <div id="evolution-content" class="hidden animate-in space-y-6">
                <div class="flex justify-between items-start border-b border-slate-100 pb-4">
                    <div>
                        <h2 id="evo-nome" class="text-xl font-bold text-slate-800">NOME DA PACIENTE</h2>
                        <div class="flex gap-4 mt-1 text-xs font-bold uppercase text-slate-500">
                            <span id="evo-leito" class="bg-slate-100 px-2 py-0.5 rounded text-slate-700">LEITO 01</span>
                            <span id="evo-tipo" class="text-blue-500">GESTANTE</span>
                        </div>
                    </div>
                    <button onclick="deletePatient()"
                        class="text-red-400 hover:text-red-600 px-3 py-1 text-xs font-bold uppercase border border-red-100 rounded hover:bg-red-50">Dar
                        Alta / Remover</button>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 bg-slate-50 p-4 rounded-xl">
                    <div class="col-span-2"><label class="label-text">Prontuário</label><input id="evo-prontuario"
                            class="input-field"></div>
                    <div><label class="label-text">Idade</label><input id="evo-idade" class="input-field"></div>
                    <div><label class="label-text">G P A</label><input id="evo-gpa" class="input-field"></div>
                    <div class="col-span-2"><label class="label-text">IG / DPO (Data Parto)</label><input id="evo-ig"
                            class="input-field"></div>
                    <div class="col-span-2"><label class="label-text">Diagnósticos (HD)</label><input id="evo-hd"
                            class="input-field"></div>
                </div>

                <div class="border border-indigo-100 bg-indigo-50/30 rounded-xl p-5">
                    <h3 class="text-xs font-bold text-indigo-700 uppercase mb-3 flex items-center gap-2"><i
                            data-lucide="list-checks" class="w-4 h-4"></i> Checklist Diário & AI</h3>
                    <div id="checklist-gestante"
                        class="grid grid-cols-2 md:grid-cols-3 gap-y-2 gap-x-4 checkbox-group hidden">
                        <label><input type="checkbox" value="MOVIMENTAÇÃO FETAL PRESERVADA" class="ai-check"> Mov. Fetal
                            OK</label>
                        <label><input type="checkbox" value="AUSÊNCIA DE SANGRAMENTOS" class="ai-check"> Sem
                            Sangramentos</label>
                        <label><input type="checkbox" value="SEM PERDA DE LÍQUIDOS" class="ai-check"> Sem Perda
                            Liq.</label>
                        <label><input type="checkbox" value="SEM QUEIXAS URINÁRIAS" class="ai-check"> Sem Queixas
                            Urin.</label>
                        <label><input type="checkbox" value="HÁBITO INTESTINAL REGULAR" class="ai-check"> Intestino
                            OK</label>
                        <label><input type="checkbox" value="SEM SINAIS DE IMINÊNCIA DE ECLÂMPSIA" class="ai-check"> Sem
                            Sinais Iminência</label>
                    </div>
                    <div id="checklist-puerpera"
                        class="grid grid-cols-2 md:grid-cols-3 gap-y-2 gap-x-4 checkbox-group hidden">
                        <label><input type="checkbox" value="DEAMBULAÇÃO LIVRE" class="ai-check"> Deambulação</label>
                        <label><input type="checkbox" value="ALEITAMENTO MATERNO EFETIVO" class="ai-check"> Aleitamento
                            OK</label>
                        <label><input type="checkbox" value="SEM QUEIXAS MAMÁRIAS" class="ai-check"> Mamas OK</label>
                        <label><input type="checkbox" value="LÓQUIOS FISIOLÓGICOS" class="ai-check"> Lóquios
                            Fisiol.</label>
                        <label><input type="checkbox" value="DIURESE E EVACUAÇÃO PRESENTES" class="ai-check">
                            Eliminações OK</label>
                        <label><input type="checkbox" value="FERIDA OPERATÓRIA LIMPA E SECA" class="ai-check"> FO
                            Cesárea OK</label>
                    </div>
                    <div class="mt-4 pt-4 border-t border-indigo-100">
                        <label class="label-text">Outras queixas / Observações</label>
                        <input id="evo-obs" class="input-field mb-2" placeholder="Digite detalhes específicos aqui...">
                        <button onclick="generateEvolutionAI()"
                            class="w-full btn-primary bg-indigo-600 hover:bg-indigo-700 text-xs py-2 shadow-sm"><i
                                data-lucide="sparkles" class="w-3 h-3"></i> Gerar HDA Narrativa ✨</button>
                    </div>
                </div>

                <div class="space-y-4">
                    <div class="h-40"><label class="label-text">HDA (Evolução Narrativa)</label><textarea id="evo-hda"
                            class="input-field h-full"></textarea></div>
                    <div class="bg-slate-50 p-4 rounded-xl">
                        <h4 class="text-xs font-bold text-slate-500 uppercase mb-3">Exame Físico / Sinais Vitais</h4>
                        <div class="grid grid-cols-2 md:grid-cols-5 gap-3 mb-3">
                            <div><label class="label-text">PA</label><input id="evo-pa" class="input-field text-center">
                            </div>
                            <div><label class="label-text">FC</label><input id="evo-fc" class="input-field text-center">
                            </div>
                            <div><label class="label-text">FR</label><input id="evo-fr" class="input-field text-center">
                            </div>
                            <div><label class="label-text">SAT</label><input id="evo-sat"
                                    class="input-field text-center"></div>
                            <div><label class="label-text">TEMP</label><input id="evo-tax"
                                    class="input-field text-center"></div>
                        </div>
                        <input id="evo-ef" class="input-field" value="BEG, LOTE, AAA, HIDRATADA, EUPNEICA.">
                        <div class="mt-2 grid grid-cols-1 md:grid-cols-2 gap-3">
                            <input id="evo-abd" class="input-field" placeholder="ABDOME / ÚTERO / LOQUIOS">
                            <input id="evo-mmii" class="input-field" placeholder="MMII (EDEMA/PANTURRILHAS)">
                        </div>
                    </div>
                    <div><label class="label-text">Conduta</label><textarea id="evo-conduta" class="input-field h-20"
                            placeholder="MANTER CONDUTA / ALTA / EXAMES"></textarea></div>
                </div>

                <div class="bg-slate-900 p-6 rounded-xl shadow-2xl">
                    <button onclick="generateFinalEvolution()"
                        class="bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded-lg text-xs font-bold mb-4 w-full md:w-auto">FINALIZAR
                        EVOLUÇÃO</button>
                    <textarea id="evo-final-text"
                        class="w-full h-80 bg-slate-800 text-slate-300 font-mono text-xs p-4 rounded-lg outline-none resize-none mb-4"
                        readonly></textarea>
                    <button onclick="copyEvo()"
                        class="w-full bg-emerald-600 text-white font-bold py-3 rounded-lg uppercase text-xs">COPIAR</button>
                </div>
            </div>
        </main>
    </div>

    <!-- SCRIPTS -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, writeBatch, getDocs, updateDoc, doc, deleteDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = window.__firebase_config || {};
        const appId = window.__app_id || "default";

        let db, auth;
        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);
            signInAnonymously(auth).then(() => {
                document.getElementById('cloud-status').innerHTML = "☁️ Online";
                document.getElementById('cloud-status').className = "text-xs font-mono text-emerald-500 font-bold";
                loadPatients();
            }).catch(e => console.error("Auth Fail", e));
        } catch (e) { console.error("Firebase Init Fail", e); }

        let currentPatientId = null;

        window.addPatient = async () => {
            const leito = document.getElementById('round-leito').value;
            const nome = document.getElementById('round-nome').value;
            const tipo = document.getElementById('round-tipo').value;
            if (!leito || !nome) return alert("Preencha leito e nome!");
            try {
                // Ensure auth strictly
                if (auth && !auth.currentUser) await signInAnonymously(auth);
                await addDoc(collection(db, `artifacts/${appId}/public/data/patients`), {
                    leito, nome, tipo,
                    status: 'active',
                    timestamp: Date.now(),
                    createdAt: new Date()
                });
                document.getElementById('round-leito').value = "";
                document.getElementById('round-nome').value = "";
            } catch (e) { alert("Erro ao salvar: " + e.message); }
        }

        window.batchImportPatients = async (patients) => {
            if (!patients || patients.length === 0) return;
            // Garantir auth antes de gravar (RULE 3)
            if (auth && !auth.currentUser) await signInAnonymously(auth);

            const batch = writeBatch(db);
            patients.forEach(p => {
                const ref = doc(collection(db, `artifacts/${appId}/public/data/patients`));
                // Mapeamento e Sanitização Estritos
                batch.set(ref, {
                    leito: p.leito?.toString() || "?",
                    nome: p.nome || "DESCONHECIDO",
                    tipo: p.tipo?.toLowerCase() || "gestante",
                    gpa: p.gpa || "",
                    ig: p.ig || "",
                    prontuario: p.prontuario || "",
                    diagnostico: p.hd || p.diagnostico || "",
                    exames: p.exames || "",
                    conduta: p.conduta || "",
                    status: 'active',
                    timestamp: Date.now(),
                    createdAt: new Date()
                });
            });
            await batch.commit();
        }

        function loadPatients() {
            if (!db) return;
            const listEl = document.getElementById('patient-list');
            onSnapshot(collection(db, `artifacts/${appId}/public/data/patients`), (snapshot) => {
                listEl.innerHTML = "";
                const patients = [];
                snapshot.forEach(doc => patients.push({ id: doc.id, ...doc.data() }));
                // Ordenação numérica de leito
                patients.sort((a, b) => {
                    const nA = parseInt(a.leito) || 0;
                    const nB = parseInt(b.leito) || 0;
                    if (nA !== nB) return nA - nB;
                    return a.leito.localeCompare(b.leito);
                });

                if (patients.length === 0) { listEl.innerHTML = '<div class="text-center text-xs text-slate-400 py-4">Nenhuma paciente.</div>'; return; }
                patients.forEach(p => {
                    const div = document.createElement('div');
                    div.className = "p-3 bg-white border border-slate-100 rounded-lg hover:border-blue-400 cursor-pointer shadow-sm group transition-all";
                    div.innerHTML = `<div class="flex justify-between items-center"><span class="font-bold text-slate-700 uppercase text-xs">LEITO ${p.leito}</span><span class="text-[10px] font-bold px-1.5 py-0.5 rounded ${p.tipo === 'gestante' ? 'bg-blue-100 text-blue-600' : 'bg-pink-100 text-pink-600'} uppercase">${p.tipo}</span></div><div class="text-sm font-semibold text-slate-800 truncate mt-1">${p.nome}</div>`;
                    div.onclick = () => loadPatientToForm(p);
                    listEl.appendChild(div);
                });
            });
        }

        window.loadPatientToForm = (p) => {
            currentPatientId = p.id;
            document.getElementById('evolution-empty').classList.add('hidden');
            document.getElementById('evolution-content').classList.remove('hidden');
            document.getElementById('evo-nome').innerText = p.nome;
            document.getElementById('evo-leito').innerText = `LEITO ${p.leito}`;
            document.getElementById('evo-tipo').innerText = p.tipo.toUpperCase();

            // Popula os campos com prioridade para dados importados
            const set = (id, v) => document.getElementById(id).value = v || '';
            set('evo-prontuario', p.prontuario);
            set('evo-gpa', p.gpa);
            set('evo-ig', p.ig);
            set('evo-hd', p.diagnostico || p.hd);
            set('evo-idade', p.idade);
            set('evo-conduta', p.conduta);

            document.getElementById('checklist-gestante').classList.add('hidden');
            document.getElementById('checklist-puerpera').classList.add('hidden');
            if (p.tipo === 'gestante') document.getElementById('checklist-gestante').classList.remove('hidden');
            else document.getElementById('checklist-puerpera').classList.remove('hidden');
        }

        window.deletePatient = async () => {
            if (!currentPatientId || !confirm("Remover paciente?")) return;
            await deleteDoc(doc(db, `artifacts/${appId}/public/data/patients`, currentPatientId));
            document.getElementById('evolution-content').classList.add('hidden');
            document.getElementById('evolution-empty').classList.remove('hidden');
        }
    </script>
    <script>
        lucide.createIcons();
        const API_KEY = "AIzaSyCqzFaH4nQGkBLLLTDyEQtbtwAUxTFeoH0";
        let MODE = 'OBST';

        window.switchModule = function (mod) {
            if (mod === 'admissao') {
                document.getElementById('module-admissao').classList.remove('hidden'); document.getElementById('module-round').classList.add('hidden');
                document.getElementById('mod-admissao').classList.add('active-module', 'text-white'); document.getElementById('mod-admissao').classList.remove('text-slate-500');
                document.getElementById('mod-round').classList.remove('active-module', 'text-white'); document.getElementById('mod-round').classList.add('text-slate-500');
            } else {
                document.getElementById('module-admissao').classList.add('hidden'); document.getElementById('module-round').classList.remove('hidden');
                document.getElementById('mod-round').classList.add('active-module', 'text-white'); document.getElementById('mod-round').classList.remove('text-slate-500');
                document.getElementById('mod-admissao').classList.remove('active-module', 'text-white'); document.getElementById('mod-admissao').classList.add('text-slate-500');
            }
        }

        // --- ROUND IMPORT ---
        window.importRound = async function (input) {
            if (!input.files[0]) return;
            const file = input.files[0];
            const loadEl = document.getElementById('import-loading');
            loadEl.classList.remove('hidden');

            try {
                let textToAnalyze = "";

                if (file.name.endsWith(".docx")) {
                    const arrayBuffer = await file.arrayBuffer();
                    const result = await mammoth.extractRawText({ arrayBuffer: arrayBuffer });
                    textToAnalyze = result.value;
                    await processTextWithGemini(textToAnalyze);
                } else if (file.type === "application/pdf") {
                    const reader = new FileReader();
                    reader.onload = async function (e) {
                        const base64 = e.target.result.split(',')[1];
                        await processPdfWithGemini(base64);
                    };
                    reader.readAsDataURL(file);
                } else {
                    alert("Formato não suportado. Use DOCX ou PDF.");
                    loadEl.classList.add('hidden');
                }

            } catch (e) {
                console.error(e);
                alert("Erro ao importar: " + e.message);
                loadEl.classList.add('hidden');
            }
        }

        async function processTextWithGemini(text) {
            const prompt = `Analise a tabela do passômetro. Cada linha é uma paciente. Extraia os campos: LEITO, NOME (da coluna ID/NOME), GPA, IG, DIAGNÓSTICOS, EXAMES e CONDUTA. Identifique se é GESTANTE ou PUÉRPERA (PPC/PPN/Parto indicam puerpera). Retorne um ARRAY de objetos JSON: [{ "leito": "...", "nome": "...", "gpa": "...", "ig": "...", "hd": "...", "conduta": "...", "tipo": "gestante" }]. Nao use markdown.`;
            await callGeminiImport(prompt, text);
        }

        async function processPdfWithGemini(base64) {
            const prompt = `Analise a tabela do passômetro. Cada linha é uma paciente. Extraia os campos: LEITO, NOME (da coluna ID/NOME), GPA, IG, DIAGNÓSTICOS, EXAMES e CONDUTA. Identifique se é GESTANTE ou PUÉRPERA (PPC/PPN/Parto indicam puerpera). Retorne um ARRAY de objetos JSON: [{ "leito": "...", "nome": "...", "gpa": "...", "ig": "...", "hd": "...", "conduta": "...", "tipo": "gestante" }]. Nao use markdown.`;
            await callGeminiImport(prompt, null, base64);
        }

        async function callGeminiImport(prompt, textData, base64Data) {
            const loadEl = document.getElementById('import-loading');
            try {
                const parts = [{ text: prompt }];
                if (textData) parts.push({ text: textData });
                if (base64Data) parts.push({ inlineData: { mimeType: "application/pdf", data: base64Data } });

                const resp = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: parts }],
                        generationConfig: { responseMimeType: "application/json" }
                    })
                });

                const data = await resp.json();
                let jsonText = data.candidates[0].content.parts[0].text;
                // Clean potential markdown blocks
                jsonText = jsonText.replace(/```json/g, '').replace(/```/g, '').trim();
                const patients = JSON.parse(jsonText);

                console.log("Extracted:", patients);

                if (window.batchImportPatients) {
                    await window.batchImportPatients(patients);
                    alert(`Sucesso! ${patients.length} pacientes importadas.`);
                }
            } catch (e) {
                console.error(e);
                alert("Erro na IA: " + e.message);
            } finally {
                loadEl.classList.add('hidden');
                document.getElementById('import-passometro').value = "";
            }
        }

        window.generateEvolutionAI = async function () {
            const obs = document.getElementById('evo-obs').value;
            const checked = Array.from(document.querySelectorAll('.ai-check:checked')).map(c => c.value);
            const tipo = document.getElementById('evo-tipo').innerText;
            const prompt = `Escreva parágrafo HDA evolução médica hospitalar para ${tipo}, em CAIXA ALTA, linguagem técnica formal e fluida. Itens: ${checked.join(', ')}. Obs: ${obs}.`;
            try {
                const resp = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${API_KEY}`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] }) });
                const data = await resp.json();
                document.getElementById('evo-hda').value = data.candidates[0].content.parts[0].text;
            } catch (e) { alert("Erro AI"); }
        }

        window.generateFinalEvolution = function () {
            const v = (id) => document.getElementById(id).value.toUpperCase().trim() || '---';
            const t = (id) => document.getElementById(id).innerText;
            const d = new Date().toLocaleDateString('pt-BR');
            let out = `# EVOLUÇÃO OBSTETRÍCIA - MATERNIDADE - ${d} #\n- NOME: ${t('evo-nome')}\n- IDADE: ${v('evo-idade')} | PRONT: ${v('evo-prontuario')}\n- GPA: ${v('evo-gpa')}\n- IG/DATA PARTO: ${v('evo-ig')}\n- DIAGNÓSTICOS (HD): ${v('evo-hd')}\n\n# HDA (EVOLUÇÃO):\n${v('evo-hda')}\n\n# EXAME FÍSICO:\nSSVV: PA: ${v('evo-pa')} | FC: ${v('evo-fc')} | FR: ${v('evo-fr')} | SAT: ${v('evo-sat')}% | TAX: ${v('evo-tax')}ºC\n- GERAL: ${v('evo-ef')}\n- ABDOME/UTERO: ${v('evo-abd')}\n- MMII: ${v('evo-mmii')}\n\n# CONDUTA:\n${v('evo-conduta')}`;
            document.getElementById('evo-final-text').value = out;
        }

        window.copyEvo = function () { document.getElementById('evo-final-text').select(); document.execCommand('copy'); alert("Copiado!"); }

        window.showTab = function (id) {
            document.querySelectorAll('#module-admissao section').forEach(s => s.classList.add('hidden'));
            document.getElementById('tab-' + id).classList.remove('hidden');
            document.querySelectorAll('.nav-btn').forEach(b => {
                b.classList.remove('active-tab', 'text-blue-700', 'bg-blue-50'); if (b.id !== 'nav-final') b.classList.add('text-slate-500');
            });
            const btn = document.getElementById('nav-' + id);
            if (id !== 'final') { btn.classList.add('active-tab', 'text-blue-700', 'bg-blue-50'); btn.classList.remove('text-slate-500'); }
        }

        window.setMode = function (mode) {
            MODE = mode;
            const btnObst = document.getElementById('btn-obst'); const btnGyn = document.getElementById('btn-gyn');
            const obstFields = document.querySelectorAll('.obst-field'); const gynFields = document.querySelectorAll('.gyn-field');
            if (mode === 'OBST') {
                btnObst.className = "px-5 py-2 rounded-md text-xs font-bold transition-all bg-white text-blue-700 shadow-sm border border-slate-200";
                btnGyn.className = "px-5 py-2 rounded-md text-xs font-bold transition-all text-slate-500 hover:text-slate-700";
                document.getElementById('header-subtitle').innerText = "URGÊNCIA OBSTETRÍCIA"; document.getElementById('header-subtitle').className = "text-xs text-blue-500 font-semibold uppercase";
                obstFields.forEach(e => e.classList.remove('hidden')); gynFields.forEach(e => e.classList.add('hidden'));
                document.getElementById('abd').value = "ABDOME GRAVIDICO, SEM DOR A PALPAÇÃO, RHA+, DB NEGATIVA."; // Default shortened
            } else {
                btnGyn.className = "px-5 py-2 rounded-md text-xs font-bold transition-all bg-white text-pink-600 shadow-sm border border-pink-200";
                btnObst.className = "px-5 py-2 rounded-md text-xs font-bold transition-all text-slate-500 hover:text-slate-700";
                document.getElementById('header-subtitle').innerText = "CONSULTA GINECOLÓGICA"; document.getElementById('header-subtitle').className = "text-xs text-pink-500 font-semibold uppercase";
                obstFields.forEach(e => e.classList.add('hidden')); gynFields.forEach(e => e.classList.remove('hidden'));
                document.getElementById('abd').value = "RHA +, FLACIDO, INDOLOR A PALPAÇÃO SUPERFICIAL E PROFUNDA, SVM OU MASSAS, DB NEGATIVA";
            }
        }

        window.generateQuestions = async function () {
            const qp = document.getElementById('qp').value; if (!qp) return;
            const box = document.getElementById('ai-questions-box'); const list = document.getElementById('questions-list');
            box.classList.remove('hidden'); list.innerHTML = 'Gerando...';
            try {
                const resp = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${API_KEY}`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: [{ parts: [{ text: "Liste 5 perguntas clinicas para anamnese de: " + qp }] }] }) });
                const data = await resp.json();
                const text = data.candidates[0].content.parts[0].text;
                list.innerHTML = text.split('\n').map(q => `<div class="mb-2"><label class="block text-slate-600 font-semibold mb-1">${q}</label><input class="input-field text-xs q-response" placeholder="Resposta..."></div>`).join('');
            } catch (e) { list.innerHTML = "Erro"; }
        }

        window.generateAnamnesisText = async function () {
            const qp = document.getElementById('qp').value;
            const resps = Array.from(document.querySelectorAll('.q-response')).map(i => i.value).join('; ');
            try {
                const resp = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${API_KEY}`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: [{ parts: [{ text: `Crie texto HDA para prontuario com base em: ${qp}. Detalhes: ${resps}` }] }] }) });
                const data = await resp.json();
                document.getElementById('hda').value = data.candidates[0].content.parts[0].text;
            } catch (e) { alert("Erro AI"); }
        }

        window.generateOutput = function () {
            const v = (id) => document.getElementById(id).value.toUpperCase().trim() || 'NEGA/NÃO INF.';
            const d = new Date().toLocaleDateString('pt-BR');
            let out = "";
            if (MODE === 'OBST') {
                out = `## URGÊNCIA OBSTETRÍCIA - DATA ${d} ###\n- NOME: ${v('nome')}\n- IDADE: ${v('idade')} | PRONT: ${v('prontuario')}\n- GPA: ${v('gpa')}\n- PARTOS: ${v('ultimo_parto')}\n- IG: ${v('ig_usg')}\n- TS/LABS: ${v('labs_triagem')}\n- COMORBIDADES: ${v('comorbidades')}\n- MUC/ALERGIAS: ${v('muc')} / ${v('alergias')}\n\n# QP: ${v('qp')}\n# HDA: ${v('hda')}\n# HD: ${v('hd_neg')}\n\n# EXAME FÍSICO:\n- GERAL: ${v('ef_geral')}\n- PA: ${v('pa')} | FC: ${v('fc')}\n- ACV: ${v('acv')} | AR: ${v('ar')}\n- ABD: ${v('abd')}\n- DINAMICA: ${v('dinamica')} | AFU: ${v('afu')} | BCF: ${v('bcf')}\n- TOQUE: ${v('tv')}\n\n# CONDUTA:\n${v('conduta')}`;
            } else {
                out = `## GINECOLOGIA - DATA ${d} ##\n- NOME: ${v('nome')}\n- IDADE: ${v('idade')}\n- GPA: ${v('gpa_gyn')}\n- QUEIXA: ${v('qp')}\n- HDA: ${v('hda')}\n- EXAME FÍSICO: ${v('ef_geral')}\n- CONDUTA: ${v('conduta')}`;
            }
            document.getElementById('final-text').value = out;
        }

        window.copyToClipboard = function () { document.getElementById('final-text').select(); document.execCommand('copy'); alert("Copiado!"); }

        window.processFile = async function () {
            const input = document.getElementById('file-input');
            if (!input.files[0]) return;
            document.getElementById('ai-status').innerText = "Lendo..."; document.getElementById('ai-status').classList.remove('hidden');
            const reader = new FileReader();
            reader.onload = async function (e) {
                try {
                    const base64 = e.target.result.split(',')[1];
                    const prompt = `Extraia JSON: nome, idade, prontuario, gpa, ultimo_parto, ig_usg, labs_triagem, comorbidades, hda, pa, fc, etc.`;
                    const resp = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${API_KEY}`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: [{ parts: [{ text: prompt }, { inlineData: { mimeType: input.files[0].type, data: base64 } }] }], generationConfig: { responseMimeType: "application/json" } }) });
                    const data = await resp.json();
                    const json = JSON.parse(data.candidates[0].content.parts[0].text);
                    const set = (id, v) => { if (document.getElementById(id) && v) document.getElementById(id).value = v; }
                    set('nome', json.nome); set('idade', json.idade); set('prontuario', json.prontuario); set('gpa', json.gpa); set('hda', json.hda);
                    document.getElementById('ai-status').innerText = "OK!";
                } catch (err) { document.getElementById('ai-status').innerText = "Erro"; }
            };
            reader.readAsDataURL(input.files[0]);
        }
    </script>
</body>

</html>